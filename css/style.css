:root{
  --bg:#1a2642;--panel:#1f2d4d;--card:#243554;--muted:#b5c4e8;--text:#f0f4ff;
  --accent:#6ba8ff;--accent-2:#8ff5dd;--border:rgba(255,255,255,.12);
  --shadow:0 12px 40px rgba(0,0,0,.4);--focus:#8ff5dd;
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;scroll-behavior:smooth}
body{
  font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
  color:var(--text);background:var(--bg);line-height:1.7;
  position:relative;overflow-x:hidden;
}

/* 3D ANIMATED BACKGROUND */
body::before{
  content:'';position:fixed;inset:0;
  background:
    radial-gradient(ellipse at 20% 30%,rgba(107,168,255,.35),transparent 50%),
    radial-gradient(ellipse at 80% 70%,rgba(143,245,221,.28),transparent 50%),
    radial-gradient(ellipse at 50% 50%,rgba(91,157,255,.22),transparent 60%);
  animation:bgFloat 20s ease-in-out infinite;z-index:0;pointer-events:none;
}
body::after{
  content:'';position:fixed;inset:0;
  background:
    repeating-linear-gradient(90deg,transparent,transparent 80px,rgba(107,168,255,.08) 80px,rgba(107,168,255,.08) 81px),
    repeating-linear-gradient(0deg,transparent,transparent 80px,rgba(143,245,221,.08) 80px,rgba(143,245,221,.08) 81px);
  animation:gridSlide 30s linear infinite;z-index:0;opacity:.7;pointer-events:none;
}

@keyframes bgFloat{
  0%,100%{transform:translate(0,0) scale(1) rotate(0deg)}
  33%{transform:translate(5%,-3%) scale(1.05) rotate(2deg)}
  66%{transform:translate(-3%,5%) scale(.95) rotate(-2deg)}
}
@keyframes gridSlide{
  0%{transform:translate(0,0)}
  100%{transform:translate(80px,80px)}
}

/* ACCESSIBILITY */
*:focus-visible{outline:3px solid var(--focus);outline-offset:4px;border-radius:6px}
.skip-link{position:absolute;top:-60px;left:16px;background:var(--accent);color:#0a1020;padding:12px 20px;font-weight:700;border-radius:8px;z-index:200;transition:top .3s}
.skip-link:focus{top:16px}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
@media(prefers-contrast:high){:root{--text:#fff;--border:rgba(255,255,255,.3)}}
@media(prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:.01ms!important;transition-duration:.01ms!important}}

.container,.site-header,.site-footer,.card,.hero,.nav,.controls{position:relative;z-index:10}

/* LAYOUT */
.container{max-width:1200px;margin:0 auto;padding:clamp(1rem,3vw,2rem)}
.site-header,.site-footer{display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:clamp(.75rem,2vw,1.25rem);background:rgba(15,25,50,.6);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;flex-wrap:wrap}
.site-footer{border-top:1px solid var(--border);border-bottom:none;position:static;margin-top:clamp(2rem,5vw,4rem)}
.brand{display:flex;align-items:center;gap:12px;font-weight:700;text-decoration:none;color:var(--text);transition:transform .3s}
.brand:hover{transform:scale(1.05)}
.brand img{width:32px;height:32px;border-radius:10px;box-shadow:var(--shadow)}

/* NAVIGATION */
.nav{display:flex;gap:clamp(.5rem,1vw,.75rem);flex-wrap:wrap}
.nav a{color:var(--muted);text-decoration:none;padding:clamp(.5rem,1vw,.75rem) clamp(.75rem,2vw,1rem);border:2px solid transparent;border-radius:12px;transition:all .3s cubic-bezier(.4,0,.2,1);position:relative;overflow:hidden}
.nav a::before{content:'';position:absolute;inset:0;background:var(--accent);opacity:0;transform:translateY(100%);transition:all .3s}
.nav a:hover::before,.nav a:focus::before{opacity:.1;transform:translateY(0)}
.nav a:hover,.nav a:focus{color:#fff;border-color:var(--border);transform:translateY(-2px) scale(1.02)}
.nav a.active{color:#fff;border-color:var(--accent);background:rgba(107,168,255,.2);box-shadow:0 4px 12px rgba(107,168,255,.3)}

/* HERO */
.hero{padding:clamp(2rem,6vw,4rem) 0}
.hero h1{font-size:clamp(2rem,5vw,3rem);line-height:1.1;margin:0 0 .75rem}
.hero .accent{color:var(--accent);text-shadow:0 0 20px rgba(107,168,255,.4)}
.hero p{color:var(--muted);max-width:900px;font-size:clamp(1rem,2vw,1.15rem)}
.cta-row{display:flex;gap:clamp(.75rem,2vw,1rem);margin-top:1.5rem;flex-wrap:wrap}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;padding:clamp(.75rem,2vw,1rem) clamp(1.25rem,3vw,1.75rem);border-radius:14px;text-decoration:none;font-weight:700;font-size:clamp(.9rem,1.5vw,1rem);transition:all .4s cubic-bezier(.4,0,.2,1);cursor:pointer;border:2px solid transparent;position:relative;overflow:hidden}
.btn::after{content:'';position:absolute;inset:0;background:radial-gradient(circle at center,rgba(255,255,255,.3),transparent 70%);opacity:0;transform:scale(0);transition:all .5s}
.btn:hover::after,.btn:focus::after{opacity:1;transform:scale(2)}
.btn.primary{background:linear-gradient(135deg,var(--accent),#5a8fff);color:#0a1020;box-shadow:0 8px 24px rgba(107,168,255,.35)}
.btn.primary:hover,.btn.primary:focus{transform:translateY(-4px) scale(1.03);box-shadow:0 16px 40px rgba(107,168,255,.5)}
.btn.ghost{border:1px solid var(--border);color:var(--text);background:rgba(255,255,255,.03)}
.btn.ghost:hover,.btn.ghost:focus{border-color:var(--accent);background:rgba(107,168,255,.15);transform:translateY(-3px)}

/* GRIDS */
.grid-2,.grid-3{display:grid;gap:clamp(1rem,2.5vw,1.75rem)}
.grid-2{grid-template-columns:1fr}
.grid-3{grid-template-columns:1fr}
@media (min-width:768px){.grid-2{grid-template-columns:1fr 1fr}.controls{grid-template-columns:repeat(3,1fr)}}
@media (min-width:900px){.grid-3{grid-template-columns:repeat(3,1fr)}}
.grid-stack .card{margin:0}

/* CARDS */
.card{background:linear-gradient(145deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:2px solid var(--border);border-radius:20px;padding:clamp(1.5rem,3vw,2.5rem);box-shadow:var(--shadow),inset 0 1px 0 rgba(255,255,255,.1);transition:all .4s cubic-bezier(.4,0,.2,1);position:relative;margin-bottom:clamp(1.5rem,3vw,2.5rem);overflow:visible}
.card::before{content:'';position:absolute;inset:-2px;border-radius:20px;background:linear-gradient(135deg,rgba(107,168,255,.2),rgba(143,245,221,.1));opacity:0;transition:opacity .4s;z-index:-1;filter:blur(12px)}
.card:hover::before,.card:focus-within::before{opacity:1}
.card:hover,.card:focus-within{border-color:rgba(107,168,255,.5);transform:translateY(-8px) scale(1.01);box-shadow:0 24px 60px rgba(0,0,0,.5),inset 0 1px 0 rgba(255,255,255,.2)}
.card h2{color:#fff;margin-top:6px;margin-bottom:clamp(.75rem,2vw,1rem);font-size:clamp(1.25rem,2.5vw,1.75rem);line-height:1.3}
.small{color:var(--muted);font-size:clamp(.85rem,1.5vw,.95rem);line-height:1.5}
.tick{padding-left:18px}
.tick li{margin:8px 0;transition:color .2s ease}
.tick li:hover{color:#fff}

/* CONTROLS */
.controls{display:grid;grid-template-columns:1fr 1fr;gap:clamp(.75rem,2vw,1.25rem);margin-bottom:clamp(1.5rem,3vw,2rem)}
.control{display:flex;flex-direction:column;gap:.5rem}
.control label{font-size:clamp(.85rem,1.5vw,.95rem);color:var(--muted);font-weight:600;cursor:pointer}
.control select,.control input{background:rgba(15,25,50,.8);color:#fff;padding:clamp(.75rem,2vw,1rem);border-radius:12px;border:2px solid var(--border);font-size:clamp(.9rem,1.5vw,1rem);transition:all .3s;cursor:pointer;min-width:180px}
.control select:hover,.control input:hover{border-color:rgba(107,168,255,.5);background:rgba(20,30,60,.9)}
.control select:focus,.control input:focus{border-color:var(--accent);background:rgba(25,35,70,1);box-shadow:0 0 0 4px rgba(107,168,255,.2),0 4px 12px rgba(107,168,255,.3);transform:scale(1.02)}

/* CHARTS */
.viz{width:100%;height:clamp(300px,50vw,500px);position:relative;min-height:260px}
.map-viz{height:clamp(350px,60vw,600px);min-height:520px}

/* TOOLTIP */
.tooltip{position:fixed;pointer-events:none;z-index:9999;background:rgba(5,15,35,.98);backdrop-filter:blur(20px) saturate(180%);color:#fff;padding:clamp(.75rem,2vw,1rem) clamp(1rem,2.5vw,1.25rem);font-size:clamp(.9rem,1.5vw,1rem);font-weight:500;border:2px solid var(--accent);border-radius:14px;box-shadow:0 12px 36px rgba(0,0,0,.8),0 0 30px rgba(107,168,255,.5),inset 0 1px 0 rgba(255,255,255,.2);transform:translate(-50%,calc(-100% - 16px));opacity:0;transition:opacity .2s ease,transform .2s ease;max-width:clamp(250px,80vw,350px);line-height:1.5}
.tooltip.show{opacity:1;transform:translate(-50%,calc(-100% - 12px))}
.tooltip::after{content:'';position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);border:10px solid transparent;border-top-color:var(--accent);filter:drop-shadow(0 2px 4px rgba(0,0,0,.5))}
.tooltip::before{content:'';position:absolute;inset:-1px;background:linear-gradient(135deg,rgba(107,168,255,.3),rgba(143,245,221,.2));border-radius:14px;z-index:-1;opacity:.5;filter:blur(8px)}
.overlay{cursor:crosshair}

/* LEGEND - FIXED FOR MOBILE */
.legend{display:flex;gap:clamp(.5rem,1.5vw,.75rem);flex-wrap:wrap;margin-top:1rem;color:var(--muted);align-items:flex-start}
.legend .row{display:flex;align-items:center;gap:8px;padding:.4rem .6rem;border-radius:8px;cursor:pointer;transition:all .3s;border:2px solid transparent;font-size:.9rem;white-space:nowrap}
.legend .row:hover{background:rgba(255,255,255,.08);border-color:var(--border);transform:translateY(-2px)}
.legend .swatch{width:18px;height:12px;border-radius:4px;border:1px solid rgba(255,255,255,.2);transition:all .3s;display:inline-block;flex-shrink:0}
.legend .row:hover .swatch{transform:scale(1.2) rotate(5deg);box-shadow:0 4px 12px currentColor}

/* LINKS */
.source-link a{color:var(--accent);font-weight:600;text-decoration:underline;position:relative;transition:all .3s}
.source-link a::after{content:'';position:absolute;bottom:-2px;left:0;width:0;height:2px;background:var(--accent-2);transition:width .3s}
.source-link a:hover::after{width:100%}
.source-link a:hover{color:var(--accent-2);text-shadow:0 0 12px rgba(143,245,221,.6)}

/* CHART STYLES */
.bar-default,.bar-highlight{transition:all .3s cubic-bezier(.68,-.55,.265,1.55);cursor:pointer}
.bar-default{fill:#6ba8ff}
.bar-default:hover{fill:#89bbff;transform:translateY(-4px) scaleY(1.05);filter:drop-shadow(0 8px 16px rgba(107,168,255,.5))}
.bar-highlight{fill:#ffb74d}
.bar-highlight:hover{fill:#ffc870;transform:translateY(-4px) scaleY(1.05);filter:drop-shadow(0 8px 16px rgba(255,183,77,.5))}
.line-camera,.line-police,.line-others,.q4-line{fill:none;stroke-width:2px;transition:all .3s}
.line-camera{stroke:#6ba8ff}
.line-police{stroke:#ffb74d}
.line-others{stroke:#c084fc}
.q4-line{stroke:#6ba8ff}
.line-camera:hover,.line-police:hover,.line-others:hover,.q4-line:hover{stroke-width:3px;filter:drop-shadow(0 4px 12px currentColor)}
.area-fill{fill:#6ba8ff;opacity:0.35;transition:opacity .3s}
.area-fill:hover{opacity:.55}
.point-default,.point-highlight{transition:all .3s cubic-bezier(.68,-.55,.265,1.55);cursor:pointer}
.point-default{fill:#1f2937;stroke:#6ba8ff;stroke-width:2}
.point-default:hover{r:8;fill:#6ba8ff;stroke:#8ff5dd;stroke-width:3;filter:drop-shadow(0 4px 12px rgba(107,168,255,.6))}
.point-highlight{fill:#ffb74d;stroke:#6ba8ff;stroke-width:2}
.point-highlight:hover{r:8;stroke:#8ff5dd;stroke-width:3;filter:drop-shadow(0 4px 12px rgba(255,183,77,.6))}
.hover-line{stroke:#ccc;stroke-width:1px;stroke-dasharray:4 4;opacity:.6}
.axis-label{fill:var(--muted);font-size:.8rem;user-select:none}
.bar-label{fill:#e8edff;font-size:.75rem;text-anchor:start;user-select:none}
.legend-text{fill:#dfe8ff;font-size:.75rem;user-select:none}
.legend-swatch-camera{fill:#6ba8ff}
.legend-swatch-police{fill:#ffb74d}
.legend-swatch-others{fill:#c084fc}
.pie-label{fill:#e8edff;font-size:0.7rem;text-anchor:middle;user-select:none;pointer-events:none}
.pie-slice{transition:opacity .3s ease;cursor:pointer}
.pie-slice:hover{opacity:.85}
svg{overflow:visible!important}
svg .bar-default,svg .bar-highlight,svg .point-default,svg .point-highlight,svg .pie-slice{cursor:pointer}

/* FILTER CHIPS */
.filter-chip{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;border-radius:25px;border:2px solid var(--border);background:rgba(255,255,255,.03);color:var(--muted);font-size:clamp(.8rem,1.5vw,.9rem);font-weight:600;cursor:pointer;transition:all .3s cubic-bezier(.4,0,.2,1)}
.filter-chip:hover{border-color:var(--accent);background:rgba(107,168,255,.15);color:#fff;transform:translateY(-3px) scale(1.05);box-shadow:0 8px 20px rgba(107,168,255,.3)}
.filter-chip.active{border-color:var(--accent);background:rgba(107,168,255,.25);color:#fff;box-shadow:0 6px 16px rgba(107,168,255,.4)}

/* STATES */
.loading{position:relative;pointer-events:none;opacity:.5}
.loading::after{content:'';position:absolute;top:50%;left:50%;width:32px;height:32px;margin:-16px 0 0 -16px;border:4px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.error-message{padding:1rem 1.25rem;background:rgba(239,68,68,.12);border:2px solid rgba(239,68,68,.4);border-radius:14px;color:#fca5a5;margin:1rem 0}
.success-message{padding:1rem 1.25rem;background:rgba(34,197,94,.12);border:2px solid rgba(34,197,94,.4);border-radius:14px;color:#86efac;margin:1rem 0}

/* ========== MOBILE OPTIMIZATIONS ========== */

@media (max-width:768px){
  /* Container and spacing */
  .container{padding:1rem}
  
  /* Cards */
  .card{padding:1.25rem;margin-bottom:1.5rem;border-radius:16px}
  .card h2{font-size:1.15rem;margin-bottom:.75rem;word-wrap:break-word;hyphens:auto}
  .small{font-size:.88rem}
  .card:hover,.card:focus-within{transform:translateY(-4px) scale(1)}
  
  /* Navigation */
  .nav{gap:.5rem;justify-content:center}
  .nav a{padding:.6rem 1rem;font-size:.9rem;border-radius:10px}
  .nav a:hover,.nav a:focus{transform:none}
  
  /* Charts */
  .viz{height:clamp(280px,60vh,400px);min-height:280px}
  .map-viz{height:clamp(320px,65vh,450px);min-height:320px}
  svg{max-width:100%;height:auto}
  
  /* Chart text sizing */
  .axis-label{font-size:.72rem}
  .bar-label{font-size:.68rem}
  .legend-text{font-size:.68rem}
  .pie-label{font-size:.68rem}
  svg text{font-size:11px!important}
  
  /* Legend improvements */
  .legend{gap:.4rem;margin-top:1rem;max-width:100%}
  .legend .row{padding:.35rem .55rem;gap:6px;font-size:.82rem}
  .legend .swatch{width:16px;height:11px}
}

@media (max-width:480px){
  /* Even tighter spacing */
  .container{padding:.75rem}
  .card{padding:1rem;margin-bottom:1.25rem;border-radius:14px}
  .card h2{font-size:1.05rem;line-height:1.25;margin-bottom:.5rem}
  .small{font-size:.85rem}
  
  /* Navigation full-width */
  .nav{gap:.4rem;width:100%}
  .nav a{padding:.5rem .8rem;font-size:.85rem;flex:1;text-align:center}
  
  /* Charts even smaller */
  .viz{height:clamp(250px,55vh,350px);min-height:250px}
  .map-viz{height:clamp(300px,60vh,400px);min-height:300px}
  
  /* Chart text even smaller */
  .axis-label{font-size:.65rem}
  .bar-label{font-size:.62rem}
  .legend-text{font-size:.62rem}
  .pie-label{font-size:.62rem}
  svg text{font-size:10px!important}
  
  /* Legend vertical stack */
  .legend{flex-direction:column;align-items:stretch;gap:.35rem}
  .legend .row{width:100%;padding:.35rem .5rem;font-size:.78rem;justify-content:flex-start}
  .legend .swatch{width:14px;height:10px}
}

/* MEDIA QUERIES */
@media print{.site-header,.site-footer,.nav,.controls,.cta-row,body::before,body::after{display:none}.card{break-inside:avoid;box-shadow:none}}
@media(hover:none){.btn,.card,.filter-chip{transform:none!important}}
[aria-hidden="true"]{visibility:hidden}
[tabindex="-1"]:focus{outline:none}
button,a,select,input{min-height:44px}